<html>
    <title>Dungeon Taptapir</title>
<body>
<script>
    //To deal with floating point numbers
    var _cf = (function() {
        function _shift(x) {
          var parts = x.toString().split('.');
          return (parts.length < 2) ? 1 : Math.pow(10, parts[1].length);
        }
        return function() { 
          return Array.prototype.reduce.call(arguments, function (prev, next) { return prev === undefined || next === undefined ? undefined : Math.max(prev, _shift (next)); }, -Infinity);
        };
      })();
      
      Math.a = function () {
        var f = _cf.apply(null, arguments); if(f === undefined) return undefined;
        function cb(x, y, i, o) { return x + f * y; }
        return Array.prototype.reduce.call(arguments, cb, 0) / f;
      };
      
      Math.s = function (l,r) { var f = _cf(l,r); return (l * f - r * f) / f; };
      
      Math.m = function () {
        var f = _cf.apply(null, arguments);
        function cb(x, y, i, o) { return (x*f) * (y*f) / (f * f); }
        return Array.prototype.reduce.call(arguments, cb, 1);
      };
      
      Math.d = function (l,r) { var f = _cf(l,r); return (l * f) / (r * f); };
      function moveItemToBeginning(arr, item) {
        const index = arr.indexOf(item);
        if (index !== -1) {
          arr.splice(index, 1);
          arr.unshift(item);
        }
      }
    </script>
    <script src="taptapir/taptapir.js"></script>
<script type="text/sunsnake">

#Global Functions
set_orientation('horizontal')
set_window_color('gray')
set_background_color('black')
ASSETS_FOLDER='assets/'
environment = []

moved=False
inrange=False

def update():
    #Smooth Follow
    camera.xy = player.xy

def input(key):
    # Collision Detection
    if key == 'w':
        for object in environment:
            if Math.a(player.y, 0.1) == object.y:
                dist=distance(player.xy,object.xy)
                if dist <= .10000000000000003:
                    moveItemToBeginning(environment, object);
            else:
                ;
        for object in environment:
            dist=distance(player.xy,object.xy)
            if dist <= .10000000000000003:
                if player.x == object.x:
                    if Math.a(player.y, 0.1) == object.y:
                        break
                    else:
                        if not moved:
                            player.y = Math.a(player.y, 0.1)
                            moved = True
                else:
                    if not moved:
                        player.y = Math.a(player.y, 0.1)
                        moved = True
            else:
                if not moved:
                    player.y = Math.a(player.y, 0.1)
                    moved = True
        moved = False
    if key == 'a':
        player.texture = 'player_left.png'
        for object in environment:
            if Math.s(player.x, 0.1) == object.x:
                dist=distance(player.xy,object.xy)
                if dist <= .10000000000000003:
                    moveItemToBeginning(environment, object);
            else:
                ;
        for object in environment:
            dist=distance(player.xy,object.xy)
            if dist <= .10000000000000003:
                if Math.s(player.x, 0.1) == object.x:
                    if player.y == object.y:
                        break
                    else:
                        if not moved:
                            player.x = Math.s(player.x, 0.1)
                            moved=True
                else:
                    if not moved:
                        player.x = Math.s(player.x, 0.1)
                        moved=True
            else:
                if not moved:
                    player.x = Math.s(player.x, 0.1)
                    moved=True
        moved=False
    if key == 's':
        for object in environment:
            if Math.s(player.y, 0.1) == object.y:
                dist=distance(player.xy,object.xy)
                if dist <= .10000000000000003:
                    moveItemToBeginning(environment, object);
            else:
                ;
        for object in environment:
            dist=distance(player.xy,object.xy)
            if dist <= .10000000000000003:
                if player.x == object.x:
                    if Math.s(player.y, 0.1) == object.y:
                        break
                    else:
                        if not moved:
                            player.y = Math.s(player.y, 0.1)
                            moved=True
                else:
                    if not moved:
                        player.y = Math.s(player.y, 0.1)
                        moved=True
            else:
                if not moved:
                    player.y = Math.s(player.y, 0.1)
                    moved=True
        moved=False
    if key == 'd':
        player.texture = 'player_right.png'
        for object in environment:
            if Math.a(player.x, 0.1) == object.x:
                dist=distance(player.xy,object.xy)
                if dist <= .10000000000000003:
                    moveItemToBeginning(environment, object);
            else:
                ;
        for object in environment:
            dist=distance(player.xy,object.xy)
            if dist <= .10000000000000003:
                if Math.a(player.x, 0.1) == object.x:
                    if player.y == object.y:
                        break
                    else:
                        if not moved:
                            player.x = Math.a(player.x, 0.1)
                            moved=True
                else:
                    if not moved:
                        player.x = Math.a(player.x, 0.1)
                        moved=True
            else:
                if not moved:
                    player.x = Math.a(player.x, 0.1)
                    moved=True
        moved=False
player = Entity(scale=.1,x=0,y=0,speed=0.1,canMove=False, texture='player_left.png')

def Box(x,y):
    box = Entity(scale=.1,x=x,y=y, texture='brick.png')
    environment.append(box)

def Open(x,y,direction):
    opening = Entity(scale=0,x=x,y=y,direction=direction)
    if opening.direction == 'left':
        opening.length = random_int(2,5)
        for i in range(opening.length):
            Box(Math.a(opening.x, (i/10)),Math.a(opening.y, 0.1))
            Box(Math.a(opening.x, (i/10)),Math.a(opening.y, -0.1))


    
Box(-.1,-.2)
Box(0,-.2)
Box(.1,-.2)
Box(.2,-.2)
Box(.2,-.1)
Box(.2,0)
Open(.2,.1,'left')
Box(.2,.2)
Box(.2,.3)
Box(-.1,.3)
Box(0,.3)
Box(.1,.3)
Box(-.2,-.2)
Box(-.2,-.1)
Box(-.2,0)
Box(-.2,.1)
Box(-.2,.2)
Box(-.2,.3)

</script>
<script src="taptapir/sunsnake_compiler.js"></script>
</body>
</html>